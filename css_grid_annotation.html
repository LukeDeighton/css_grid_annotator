<!DOCTYPE html>
<html>
<head>
  <title>Grid Annotator</title>
  <style type="text/css">
    .container {
      background-color: antiquewhite;
      display: grid;
      display: -ms-grid;
      grid-template-columns: 1fr 1fr;
      -ms-grid-columns: 1fr 1fr;
    }
    .elm {
      background-color: rgba(0, 0, 255, 0.3);
      margin: 10px;
      padding: 10px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="elm">Lorem A</div>
    <div class="elm">Ipsum B</div>
    <div class="elm">Dolor C</div>
    <div class="elm">Sit D</div>
    <div class="elm">Amet E</div>
   </div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.2.5/polyfill.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel" data-presets="es2015" type="text/javascript">
// NOTE: Unfortunately, we can not move this script to its own file because somehow the transpiling does not work then anymore.
//
// Only applied when IE11 is found.
// Annotates the children of elements that have display-type grid.
// Based on the grid-template-columns style attribute, it annotates the children with grid-column and grid-row.
// NOTE: This script does not work if there is only grid-template-rows specified, it needs grid-template-rows-columns.
// NOTE: This annotation is quite expensive (only for IE11), because check every element on the page for its display type. Furthermore, for each grid container we look through all style definitions.
class GridItemAnnotator {
  /* eslint-disable lines-between-class-members, no-console */
  static CSS_DISPLAY_GRID = "-ms-grid";
  static CSS_TEMPLATE_COLS = "-ms-grid-columns";
  static CSS_ROW = "-ms-grid-row";
  static CSS_COL = "-ms-grid-column";

  static annotate() {
    if (!this.isIE11()) { return; }
    // we have to go through every single element to check the computed style
    // this is very performance heavy
    for (const elm of document.querySelectorAll("*")) {
      if (this.isGridContainer(elm)) {
        this.annotateElement(elm);
      }
    }
  }

  static annotateElement(elm) {
    const colCount = this.getTemplateColCount(elm);
    for (const [i, child] of Array.from(elm.children).entries()) {
      child.style[this.CSS_COL] = (i % colCount) + 1;
      child.style[this.CSS_ROW] = Math.floor(i / colCount) + 1;
    }
  }

  // returns the number of elements in a computed grid-template-columns attribute.
  // We do not need to consider functions such as repeat or minmax, because they are not supported by IE11 anyway (so either the autoprefixer resolves them or the style definition is broken for IE11 anyway).
  static getTemplateColCount(elm) {
    const styles = window.getComputedStyle(elm);
    return styles.getPropertyValue(this.CSS_TEMPLATE_COLS).split(" ").length;
  }

  static isGridContainer(elm) {
    const styles = window.getComputedStyle(elm);
    return styles.display === this.CSS_DISPLAY_GRID;
  }

  static isIE11() {
    const agent = navigator.userAgent;
    return (agent.indexOf("Trident") >= 0) && (agent.indexOf("rv:11") >= 0);
  }
}

window.addEventListener("load", () => { GridItemAnnotator.annotate(); });
</script>


</body>
</html>